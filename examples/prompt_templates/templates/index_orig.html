<!DOCTYPE html>
<html>
<head>
    <title>Daring Mechanician AI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            background-color: #333; /* Darker grey for the textarea */
            color: white; /* White text */
            font-family: Helvetica, sans-serif; /* Helvetica or fallback to sans-serif */
            font-size: 18px; /* Adjusted font size */
        }

        #header {
            position: fixed;
            top: 0;
            width: 100%;
            background-color: #333; /* Darker grey */
            color: white;
            text-align: left; /* Text aligned to the left */
            padding: 10px 20px; /* Adjusted padding */
            font-size: 32px;
            z-index: 1000;
        }

        #footer {
            position: fixed;
            bottom: 10px; /* Slightly raised from the bottom */
            left: 0;
            width: 100%;
            z-index: 1000;
            display: flex;
            justify-content: center; /* Center the footer content */
        }


        #inputContainer {
            width: 50%; /* Input container occupies 50% of the width */
            display: flex;
            border: 1px solid white; /* Thin white border */
            padding: 5px; /* Padding inside the container */
            box-sizing: border-box; /* Ensure padding and border are included in the width */
            align-items: center; /* Align the items vertically in the center */
            justify-content: space-between; /* Adjust based on your layout preference */
            border-radius: 5px; /* Optional: Adds rounded corners to the container */
        }

        /* Adjusted #content area to not overlap with the footer */
        #content {
            position: fixed;
            top: 60px; /* Height of the header */
            bottom: 70px; /* Height of the footer + some space for margin */
            overflow-y: auto;
            width: 100%;
            padding: 0 10px; /* Adjust as needed */
            height: calc(100% - 160px); /* Adjusted height to fill between header and footer */
        }

        textarea {
            margin: 0; /* Remove default margins */
            flex-grow: 1; /* Allow textarea to grow */
            background-color: #333; /* Darker grey for the textarea */
            color: white; /* White text */
            border: none; /* Remove border */
            padding: 5px; /* Reduced padding */
            resize: none; /* Prevent resizing */
            font-size: 18px; /* Adjusted font size */
            font-family: Helvetica, sans-serif; /* Consistent font */
            overflow-y: hidden; /* Hide the overflow */
            height: 30px; /* Reduced initial height */
            min-height: 30px; /* Ensure it does not go smaller than a single line */
        }



        button {
            margin: 0; /* Remove default margins */
            padding: 10px 20px; /* Padding around the text */
            background-color: #333; /* Darker grey button */
            color: white; /* White text */
            border: none; /* Remove border */
            cursor: pointer; /* Pointer cursor on hover */
            font-size: 18px; /* Adjusted font size */
            font-family: Helvetica, sans-serif; /* Consistent font */
        }

        button:hover {
            background-color: #777; /* Lighter grey on hover */
        }


        p {
            margin: 20px 10px;
        }

        .message-container {
            margin: 20px 10px;
        }

        .message-header, .message-text {
            margin-left: 10px; /* Ensure alignment */
        }

        .message-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 0px; /* Minimize the vertical gap by reducing bottom margin */
        }

        .message-text {
            font-size: 16px;
            margin-top: 10px; /* Ensure minimal space above the message text */
            margin-bottom: 30px; /* Increase the gap between this message and the next header */
        }


    </style>
</head>
<body>

    <div id="header">Daring Mechanician AI</div>

    <div id="content">
        <div id="messages"></div>
    </div>

    <div id="footer">
        <div id="inputContainer">
            <textarea id="input" placeholder="Type your message here..."></textarea>
            <button id="send">&#x2B06;</button>
        </div>
    </div>

    <script>
        var socket = io('http://' + document.domain + ':' + location.port, {
            reconnectionAttempts: 5, // Maximum number of reconnection attempts
            reconnectionDelay: 2000, // How long to initially wait before attempting a new reconnection
            reconnectionDelayMax: 5000, // Maximum amount of time to wait between reconnection attempts
        });
        var currentAIResponse = null; // Reference to the current AI response container
    
        socket.on('connect', function() {
            console.log('Connected to the server.');
        });
    
        socket.on('disconnect', function(reason) {
            console.log('Disconnected from the server:', reason);
            $('#messages').append($('<p>').html("<strong>System:</strong> Disconnected. Attempting to reconnect..."));
        });
    
        socket.on('reconnect', function(attemptNumber) {
            console.log('Reconnected to the server after ' + attemptNumber + ' attempts.');
            $('#messages').append($('<p>').html("<strong>System:</strong> Reconnected to the server."));
        });
    
        function sendPrompt() {
            var promptText = $('#input').val().trim();
            if (promptText) {
                let userMessageContainer = $('<div class="message-container">');
                userMessageContainer.append($('<p class="message-header">').html("You"));
                userMessageContainer.append($('<p class="message-text">').text(promptText)); // Wrap user message text with `message-text` class for styling
                $('#messages').append(userMessageContainer);
                socket.emit('message', {data: promptText});
                $('#input').val('');
                adjustTextareaHeight(); // Adjust height after clearing
                currentAIResponse = null; // Reset for a new response
            }
        }

    
        $('#send').click(sendPrompt);
    
        $('#input').on('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendPrompt();
            }
        });
    
        socket.on('response', function(msg) {
            if (msg.data === 'END_OF_RESPONSE') {
                $('#messages').append($('<hr>')); // Visually separate responses
                currentAIResponse = null; // Prepare for the next response
            } else {
                if (!currentAIResponse) {
                    let aiMessageContainer = $('<div class="message-container">');
                    aiMessageContainer.append($('<p class="message-header">').html("AI"));
                    currentAIResponse = $('<p class="message-text">'); // Wrap the AI message text
                    aiMessageContainer.append(currentAIResponse);
                    $('#messages').append(aiMessageContainer);
                }
                let contentWithBreaks = msg.data.replace(/\n/g, '<br>');
                currentAIResponse.append(contentWithBreaks);
            }
        });


    
        // Automatically adjust the textarea's height
        function adjustTextareaHeight() {
            var textarea = document.getElementById('input');
            textarea.style.height = 'auto'; // Reset the height to auto to accurately read scrollHeight
            textarea.style.height = textarea.scrollHeight + 'px'; // Set the new height based on the content
        }

        // Initialize the textarea adjustment function on input event
        document.getElementById('input').addEventListener('input', adjustTextareaHeight);

        // Adjust textarea height on page load in case there's pre-filled content
        document.addEventListener('DOMContentLoaded', function() {
            adjustTextareaHeight();
        });

        // Add event listener to adjust height
        document.getElementById('input').addEventListener('input', adjustTextareaHeight);
    
        // Initial adjustment in case there's pre-filled content
        adjustTextareaHeight();

    </script>
    
</body>
</html>
